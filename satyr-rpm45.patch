--- satyr-0.3/lib/rpm.c.orig	2013-03-25 15:07:04.000000000 +0100
+++ satyr-0.3/lib/rpm.c	2013-04-06 10:59:35.792721546 +0200
@@ -27,7 +27,6 @@
 #include <rpm/rpmlib.h>
 #include <rpm/rpmdb.h>
 #include <rpm/rpmts.h>
-#include <rpm/rpmtd.h>
 #include <rpm/header.h>
 #endif
 #include <fcntl.h>
@@ -249,18 +248,20 @@
                   rpmTag tag,
                   char **result)
 {
-    rpmtd tag_data = rpmtdNew();
-    int success = headerGet(header,
-                            tag,
-                            tag_data,
-                            HEADERGET_DEFAULT);
+    
+    int_32 type, cnt;
+    void *p;
+    const char **strp;
+    int success = headerGetEntry(header, tag, &type, &p, &cnt);
 
     if (success != 1)
         return false;
 
-    const char *str = rpmtdGetString(tag_data);
+    const char *str = (type == RPM_STRING_TYPE) ? p :
+	    (((type == RPM_STRING_ARRAY_TYPE) || (type == RPM_I18NSTRING_TYPE)) ? *(strp = p) : NULL);
     *result = (str ? sr_strdup(str) : NULL);
-    rpmtdFree(tag_data);
+    if(type == RPM_STRING_ARRAY_TYPE)
+	    free(p);
     return str;
 }
 
@@ -269,20 +270,19 @@
                   rpmTag tag,
                   uint32_t *result)
 {
-    rpmtd tag_data = rpmtdNew();
-    int success = headerGet(header,
-                            tag,
-                            tag_data,
-                            HEADERGET_DEFAULT);
+    int_32 type, cnt;
+    void *p;
+    int success = headerGetEntry(header, tag, &type, &p, &cnt);
 
     if (success != 1)
         return false;
 
-    uint32_t *num = rpmtdGetUint32(tag_data);
+    if (type != RPM_UINT32_TYPE)
+        return false;
+    uint32_t *num = p;
     if (num)
         *result = *num;
 
-    rpmtdFree(tag_data);
     return num;
 }
 
